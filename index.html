<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Statistical Analytics Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>

  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.3/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@0.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ccapture.js@1.0.3/CCapture.all.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    function StatisticalAnalyticsDashboard() {
      const [data, setData] = useState([]);
      const [filteredData, setFilteredData] = useState([]);
      const [selectedChart, setSelectedChart] = useState("line");
      const [descriptiveStats, setDescriptiveStats] = useState({});
      const chartRef = useRef(null);

      // Function to calculate and set descriptive statistics
      const calculateStats = (data) => {
        const values = data.map(item => item[1]); // Assuming 2nd column is numeric
        const mean = values.reduce((a, b) => a + b, 0) / values.length;
        const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / values.length;
        const stdDev = Math.sqrt(variance);
        setDescriptiveStats({ mean, variance, stdDev });
      };

      // File upload handler
      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (evt) => {
          const wb = XLSX.read(evt.target.result, { type: "binary" });
          const ws = wb.Sheets[wb.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
          setData(rows.slice(1));
          setFilteredData(rows.slice(1));
          calculateStats(rows.slice(1));
        };
        reader.readAsBinaryString(file);
      };

      // Render the chart
      const renderChart = () => {
        const ctx = document.getElementById("chartCanvas").getContext("2d");
        if (chartRef.current) chartRef.current.destroy();
        
        chartRef.current = new Chart(ctx, {
          type: selectedChart,
          data: {
            labels: filteredData.map(row => row[0]),
            datasets: [{
              label: 'Data',
              data: filteredData.map(row => row[1]),
              borderColor: "rgba(75, 192, 192, 1)",
              backgroundColor: "rgba(75, 192, 192, 0.2)",
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
      };

      useEffect(() => {
        renderChart();
      }, [filteredData, selectedChart]);

      // Filter data
      const filterData = (filterValue) => {
        const newData = data.filter(item => item[0].includes(filterValue));
        setFilteredData(newData);
      };

      return (
        <div className="bg-white p-6 rounded-xl shadow-lg max-w-3xl mx-auto">
          <h1 className="text-3xl font-bold text-center mb-6">Statistical Analytics Dashboard</h1>

          <div className="mb-6">
            <input type="file" accept=".xlsx, .xls, .csv" onChange={handleFileUpload} className="w-full p-2 border rounded"/>
          </div>

          <div className="mb-4">
            <h3 className="text-xl">Descriptive Statistics</h3>
            <ul>
              <li>Mean: {descriptiveStats.mean}</li>
              <li>Variance: {descriptiveStats.variance}</li>
              <li>Standard Deviation: {descriptiveStats.stdDev}</li>
            </ul>
          </div>

          <div className="mb-6">
            <label htmlFor="chartSelect" className="text-lg">Select Chart Type:</label>
            <select id="chartSelect" className="w-full p-2 mt-2" onChange={(e) => setSelectedChart(e.target.value)}>
              <option value="line">Line Chart</option>
              <option value="bar">Bar Chart</option>
              <option value="pie">Pie Chart</option>
              <option value="scatter">Scatter Plot</option>
            </select>
          </div>

          <div className="mb-6">
            <label htmlFor="filterInput" className="text-lg">Filter Data:</label>
            <input
              id="filterInput"
              type="text"
              className="w-full p-2 mt-2"
              placeholder="Filter by category"
              onChange={(e) => filterData(e.target.value)}
            />
          </div>

          <div className="mb-6">
            <canvas id="chartCanvas" width="400" height="300"></canvas>
          </div>

          <div className="mb-6 flex justify-between">
            <button className="bg-blue-500 text-white p-2 rounded">Download CSV</button>
            <button className="bg-green-500 text-white p-2 rounded">Save Chart as Image</button>
            <button className="bg-red-500 text-white p-2 rounded">Capture Animation</button>
          </div>
        </div>
      );
    }

    ReactDOM.render(<StatisticalAnalyticsDashboard />, document.getElementById("root"));
  </script>
</body>
</html>
